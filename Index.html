<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Medallion Forge ‚Äî Production Overhaul</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0c101a; --panel: #161b2a; --ink: #eaf2fa;
      --muted: #8894a6; --accent: #67e7ff; --accent2: #5a75fe;
      --glow: rgba(103,231,255,0.34); --line: #252b39;
      --ok: #22c55e; --warn: #f59e0b; --bad: #ef4444;
      --mono: "JetBrains Mono","Fira Code",ui-monospace,Menlo,Consolas,monospace;
      --sans: Inter,system-ui,"Segoe UI",Roboto,Arial,sans-serif;
      --r: 18px; --header: 64px; --shadow: 0 16px 48px rgba(0,0,0,.25);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg:#f6f8fc; --panel:#fff; --ink:#0f172a; --muted:#5b6b7f;
        --accent:#2563eb; --accent2:#22d3ee; --glow:rgba(37,99,235,.22);
        --line:#e7eaf0; --ok:#16a34a; --warn:#d97706; --bad:#dc2626;
      }
    }
    body {
      margin:0; background:var(--bg); color:var(--ink);
      font:15px/1.5 var(--sans); -webkit-text-size-adjust:100%;
      min-height:100dvh; transition:background .4s, color .4s;
      padding-bottom:max(18px,env(safe-area-inset-bottom));
      display:flex; flex-direction:column;
    }
    header {
      position:sticky; top:0; z-index:51;
      background:linear-gradient(90deg, color-mix(in oklab,var(--panel) 96%, black 4%), color-mix(in oklab,var(--panel) 88%, black 12%));
      border-bottom:1px solid var(--line);box-shadow:0 4px 24px #0002;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      height:calc(var(--header) + env(safe-area-inset-top));
      padding: max(0px, env(safe-area-inset-top)) 20px 0 20px;
    }
    .brand {
      display:flex;gap:14px;align-items:center;
    }
    .logo {
      width:40px;height:40px;border-radius:12px;display:grid;place-items:center;
      background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff;font-weight:900;box-shadow:0 0 22px var(--glow);
    }
    .pill {
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      padding:4px 12px;border-radius:999px;color:#fff;font-size:12px;font-weight:700;
      letter-spacing:.43px;margin-left:4px;
    }
    .chip,.btn {
      border:1px solid var(--line); background:var(--panel); color:var(--ink);
      border-radius:12px; padding:12px 16px; min-height:42px;
      display:inline-flex; align-items:center; gap:7px; cursor:pointer;
      font-weight:600; letter-spacing:.03em; user-select:none; transition:.2s;
    }
    .chip:hover,.btn:hover {
      border-color:var(--accent); color:var(--accent); box-shadow:0 0 0 3px var(--glow);
    }
    .primary {
      border:none; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#fff;
    }
    .toolbar {
      display:flex; gap:12px; flex-wrap:wrap; align-items:center;
    }
    main {
      flex:1; display:grid; max-width:1200px; margin:0 auto; gap:24px;
      padding:24px; grid-template-columns: 1fr 1fr;
    }
    @media (max-width:900px){ main{grid-template-columns:1fr;} }
    .card {
      background:color-mix(in oklab,var(--panel) 97%, black 3%);
      border:1px solid var(--line); border-radius:20px; box-shadow:var(--shadow);
      padding:22px 18px 18px 18px; margin-bottom:0;
      display:flex; flex-direction:column; gap:16px;
    }
    .card h2 { margin:0; font-size:17px; display:flex; align-items:center; gap:8px; color:color-mix(in oklab,var(--ink) 88%, var(--muted) 12%) }
    .subtle { font-size:13px; color:var(--muted); margin-top:-8px;}
    .profiles { display:grid; gap:14px; margin-top:8px;}
    .profile {
      display:grid; grid-template-columns:52px 1fr auto; gap:13px; align-items:center;
      border:1px solid var(--line); border-radius:12px; padding:12px; background:var(--panel);
      cursor:pointer; transition:.14s;
      box-shadow:0 2px 8px #0001;
      animation:popFade .34s cubic-bezier(.45,2.1,.57,.97);
    }
    @keyframes popFade {from{opacity:.3;transform:scale(.95);}to{opacity:1;transform:scale(1);}}
    .profile:hover{border-color:var(--accent); box-shadow:0 0 0 4px var(--glow)}
    .thumb{width:52px;height:52px;border-radius:14px;display:grid;place-items:center;background:radial-gradient(120% 100% at 25% 20%,var(--accent) 4%,var(--accent2) 70%); color:#fff; font-weight:800;font-size:22px}
    .tag{font-size:11px; padding:3px 9px; border-radius:999px; background:color-mix(in oklab,var(--accent) 24%, transparent); color:var(--accent)}
    .row{display:flex; flex-direction:column; gap:7px}
    label{font-size:13px; font-weight:700; color:color-mix(in oklab,var(--ink) 90%, var(--muted) 10%); display:flex; gap:4px; align-items:center}
    input,select,textarea {
      font:15px var(--sans); width:100%; padding:13px 13px; border-radius:12px;
      border:1px solid var(--line); background:color-mix(in oklab, var(--bg) 92%, black 8%);
      color:var(--ink); outline:none; transition:.15s;
    }
    input:focus,select:focus,textarea:focus {
      border-color:var(--accent); box-shadow:0 0 0 4px var(--glow); background:var(--panel);
    }
    .tabs{display:flex; gap:10px; border-bottom:1px solid var(--line); padding-bottom:8px; margin-bottom:9px}
    .tab{padding:12px 18px; background:transparent; border:1px solid transparent; border-radius:12px; color:var(--muted); font-weight:600; cursor:pointer; transition:.22s}
    .tab:hover{background:color-mix(in oklab, var(--accent) 10%, transparent); color:var(--accent)}
    .tab[aria-selected="true"]{background:var(--glow); border-color:var(--accent); color:var(--accent)}
    .tabpanel[hidden]{display:none;}
    .stage{
      position:relative;min-height:340px; height:56svh;border:1px solid var(--line);
      border-radius:20px; overflow:hidden; background: linear-gradient(to bottom right,#fff1, #0000), color-mix(in oklab,var(--panel) 96%, black 4%);
      display:flex;align-items:center;justify-content:center;touch-action:none;user-select:none;
    }
    #inner{position:absolute; top:50%; left:50%; transform-origin:0 0; will-change:transform}
    .toast {
      position:fixed; right:22px; bottom:22px; z-index:99;
      border:1px solid var(--line); border-left:5px solid var(--ok); background:var(--panel);
      border-radius:14px; padding:13px 18px; display:flex; gap:8px; align-items:center; box-shadow:var(--shadow);
      transform:translateY(120px); opacity:0; transition:.37s; font-size:15px;
      animation:toastIn .7s cubic-bezier(.45,2.5,.57,.97) forwards;
    }
    .toast.show {transform:translateY(0); opacity:1;}
    .toast.error{border-left-color:var(--bad);}
    @keyframes toastIn{from{transform:translateY(80px);opacity:.4;}to{transform:translateY(0);opacity:1;}}
    @media (max-width:600px){
      main { padding:10px; }
      .card { padding:12px 8px; border-radius:13px;}
      .chip,.btn { padding:8px 8px; min-height:32px;}
      header{height:calc(56px + env(safe-area-inset-top))}
      .logo{width:34px;height:34px}
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true">‚öîÔ∏è</div>
    <div>
      <strong style="font-size:19px">Medallion Forge</strong>
      <span class="pill">PRODUCTION</span>
      <div class="subtle">Polished Builder ‚Ä¢ Mobile-first ‚Ä¢ Live SVG</div>
    </div>
  </div>
  <div class="toolbar" role="group" aria-label="Actions">
    <button id="themeToggle" class="chip" type="button" aria-pressed="false" title="Toggle theme"><span class="material-icons" aria-hidden="true">dark_mode</span></button>
    <button id="exportBtn" class="chip" type="button" title="Export"><span class="material-icons" aria-hidden="true">ios_share</span></button>
    <button id="importBtn" class="chip" type="button" title="Import"><span class="material-icons" aria-hidden="true">download</span></button>
    <button id="randBtn" class="chip" type="button" title="Random"><span class="material-icons" aria-hidden="true">casino</span></button>
    <button id="clearBtn" class="chip" type="button" title="Clear"><span class="material-icons" aria-hidden="true">backspace</span></button>
  </div>
</header>

<main>
  <section class="card" style="max-width:480px">
    <h2><span class="material-icons" aria-hidden="true">view_carousel</span> Presets</h2>
    <input id="profileSearch" placeholder="üîç Find presets..." aria-label="Search presets" />
    <div class="profiles" id="profiles"></div>
  </section>

  <section class="card">
    <h2><span class="material-icons" aria-hidden="true">build</span> Builder</h2>
    <div class="tabs" role="tablist">
      <button class="tab" data-tab="basic" aria-controls="panel-basic" aria-selected="true">Basic</button>
      <button class="tab" data-tab="symbols" aria-controls="panel-symbols" aria-selected="false" tabindex="-1">Symbols</button>
      <button class="tab" data-tab="style" aria-controls="panel-style" aria-selected="false" tabindex="-1">Style & Export</button>
    </div>
    <div id="panel-basic" class="tabpanel">
      <div class="row"><label for="text_top"><span class="material-icons">title</span> Top Text</label>
        <input id="text_top" placeholder="SAINT CLOUD JEDI" autocomplete="off" /></div>
      <div class="row"><label for="rim_finish"><span class="material-icons">settings</span> Rim Finish</label>
        <input id="rim_finish" placeholder="metallic silver" /></div>
      <div class="row"><label for="plate_color"><span class="material-icons">palette</span> Plate Color</label>
        <input id="plate_color" placeholder="black" /></div>
      <div class="row"><label for="text_colors"><span class="material-icons">format_color_text</span> Text Fill / Outline</label>
        <input id="text_colors" placeholder="white with black outline" /></div>
      <div class="row"><label for="state_shape"><span class="material-icons">polyline</span> Main Outline</label>
        <input id="state_shape" placeholder="state of Florida" /></div>
      <div class="row"><label for="outline_color"><span class="material-icons">border_color</span> Outline Color</label>
        <input id="outline_color" placeholder="white" /></div>
      <div class="row"><label for="flip_arc"><span class="material-icons">flip</span> Flip Top Text</label>
        <select id="flip_arc">
          <option value="auto" selected>Auto</option>
          <option value="normal">Normal</option>
          <option value="flipped">Flipped</option>
        </select></div>
    </div>
    <div id="panel-symbols" class="tabpanel" hidden>
      <div class="row"><label for="main_symbol"><span class="material-icons">star</span> Main Symbol</label>
        <input id="main_symbol" placeholder="Death Star" /></div>
      <div class="row"><label for="symbol_color"><span class="material-icons">color_lens</span> Symbol Color</label>
        <input id="symbol_color" placeholder="red with etched lines" /></div>
      <div class="row"><label for="badge_elements"><span class="material-icons">category</span> Badge Elements</label>
        <input id="badge_elements" placeholder="concentric rings" /></div>
      <div class="row"><label for="secondary_symbol"><span class="material-icons">workspace_premium</span> Secondary Symbol</label>
        <input id="secondary_symbol" placeholder="Army star emblem" /></div>
      <div class="row"><label for="aurebesh_style"><span class="material-icons">translate</span> Aurebesh Style</label>
        <input id="aurebesh_style" placeholder="glowing Aurebesh along rim" /></div>
      <div class="row"><label for="sabers_desc"><span class="material-icons">flash_on</span> Lightsabers</label>
        <input id="sabers_desc" placeholder="two crossed sabers glow" /></div>
    </div>
    <div id="panel-style" class="tabpanel" hidden>
      <div class="row"><label for="style_keywords"><span class="material-icons">style</span> Style Keywords</label>
        <input id="style_keywords" placeholder="cinematic, heraldic, symmetrical" /></div>
      <div class="row"><label for="out"><span class="material-icons">notes</span> Generated Prompt</label>
        <textarea id="out" spellcheck="false" placeholder="Generated prompt appears here‚Ä¶" style="min-height:120px; font:13px/1.5 var(--mono)"></textarea></div>
      <div class="toolbar" role="group" aria-label="Export & Share">
        <button id="copyBtn" class="btn" type="button"><span class="material-icons">content_copy</span>Copy Text</button>
        <button id="downloadBtn" class="btn" type="button"><span class="material-icons">save</span>Download TXT</button>
      </div>
      <div class="subtle">Shortcuts: Ctrl+Enter = Generate ‚Ä¢ Ctrl+C inside prompt = Copy</div>
    </div>
  </section>

  <section class="card">
    <h2><span class="material-icons" aria-hidden="true">visibility</span> Live SVG Preview</h2>
    <div class="toolbar">
      <button class="chip" id="resetView" type="button"><span class="material-icons">restart_alt</span>Reset View</button>
      <span class="chip" id="hudZoom">Zoom 100%</span>
      <span class="chip" id="hudSize">‚Äî</span>
    </div>
    <div class="stage" id="stage"><div id="inner"></div></div>
  </section>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"><span class="material-icons" aria-hidden="true">check_circle</span><span id="toastMsg">Done</span></div>

<script>
// Storage, theme, and toast utilities
const LS_FORM = 'medallion:form:overhaul';
const LS_THEME = 'medallion:theme:light';
function toast(msg,err){const t=document.getElementById('toast');t.classList.toggle('error',!!err);document.getElementById('toastMsg').textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000);}
(function(){
  const stored = localStorage.getItem(LS_THEME);
  if(stored==='1') document.body.classList.add('theme-light');
  paintTheme();
})();
function paintTheme(){
  const light = document.body.classList.contains('theme-light');
  const toggle = document.getElementById('themeToggle');
  if (!toggle) return;
  toggle.setAttribute('aria-pressed',light?'true':'false');
  toggle.children.textContent = light?'light_mode':'dark_mode';
}
document.getElementById('themeToggle').addEventListener('click',()=>{
  const l = document.body.classList.toggle('theme-light');
  localStorage.setItem(LS_THEME, l?'1':'0'); paintTheme();
  toast(l?"Light theme":"Dark theme");
});

// Tabs handler
const tabs = Array.from(document.querySelectorAll('.tab'));
const panels = {basic:document.getElementById('panel-basic'),symbols:document.getElementById('panel-symbols'),style:document.getElementById('panel-style')};
function setTab(t){
  const id = t.dataset.tab;
  tabs.forEach(btn=>{
    btn.setAttribute('aria-selected',String(btn===t));
    btn.tabIndex = btn===t?0:-1;
  });
  Object.entries(panels).forEach(([k,p])=>p.hidden=(k!==id));
  t.focus();
}
tabs.forEach((tab,i)=>{
  tab.addEventListener('click',()=>setTab(tab));
  tab.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') setTab(tabs[(i+1)%tabs.length]);
    if(e.key==='ArrowLeft') setTab(tabs[(i-1+tabs.length)%tabs.length]);
    if(e.key==='Home') setTab(tabs);
    if(e.key==='End') setTab(tabs.at(-1));
  });
});
setTab(tabs);

// Form IO
const FIELDS = ["text_top","rim_finish","plate_color","text_colors","state_shape","outline_color","main_symbol","symbol_color","badge_elements","secondary_symbol","aurebesh_style","sabers_desc","style_keywords","flip_arc"];
function readForm(){
  const v = {}; FIELDS.forEach(id=>v[id]=(document.getElementById(id)?.value||'').trim());
  return v;
}
function fillForm(data,andGenerate){
  FIELDS.forEach(k=>{const el=document.getElementById(k);if(el&&data[k]!=null){el.value=data[k];}});
  if(andGenerate) generate();
}
FIELDS.forEach(id=>{
  const el=document.getElementById(id); if(!el) return;
  ['input','change'].forEach(ev=>el.addEventListener(ev,()=>{generate();localStorage.setItem(LS_FORM,JSON.stringify(readForm()));}));
});
document.getElementById('clearBtn').addEventListener('click',()=>{
  localStorage.removeItem(LS_FORM); fillForm({},true); toast('Cleared');
});

// Prompt builder & export
function buildPrompt(v){
  return [
    "Cinematic medallion design:",
    `Shape: Round, ${v.rim_finish}, plate: ${v.plate_color}`,
    `Text: ‚Äú${v.text_top}‚Äù in ${v.text_colors}`,
    `Motif: ${v.state_shape} (${v.outline_color}), ${v.main_symbol} (${v.symbol_color}). Elements: ${v.badge_elements}${v.secondary_symbol?`. Secondary: ${v.secondary_symbol}`:''}`,
    `Aurebesh: ${v.aurebesh_style}`,
    `Lightsabers: ${v.sabers_desc}`,
    `Style: ${v.style_keywords}`
  ].join("\n");
}
function generate(){
  const v = readForm();
  document.getElementById('out').value = buildPrompt(v);
  mount(buildMedallionSvg(v));
  renderPreview();
}
document.getElementById('copyBtn').addEventListener('click',()=>{
  navigator.clipboard?.writeText(document.getElementById('out').value||"").then(()=>toast('Copied prompt'));
});
document.getElementById('downloadBtn').addEventListener('click',()=>{
  const blob = new Blob([document.getElementById('out').value||""], {type: "text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = "medallion_prompt.txt";
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  toast('Downloaded');
});

// SVG preview logic
const stage=document.getElementById('stage'), inner=document.getElementById('inner'), hudZoom=document.getElementById('hudZoom'), hudSize=document.getElementById('hudSize');
let view = {x:0, y:0, k:1, min:.09, max:6, w:400, h:400, rot:0};
new ResizeObserver(()=>{
  const r=stage.getBoundingClientRect();
  hudSize.textContent=`${Math.round(r.width)}√ó${Math.round(r.height)}px`;
  renderPreview();
}).observe(stage);
function renderPreview(){
  const W=stage.clientWidth,H=stage.clientHeight;
  inner.style.transform=`translate(${(W/2)+view.x}px,${(H/2)+view.y}px) rotate(${view.rot}deg) scale(${view.k}) translate(${-view.w/2}px,${-view.h/2}px)`;
  hudZoom.textContent = `Zoom ${Math.round(view.k*100)}%`;
}
function mount(svg){
  inner.innerHTML=''; inner.appendChild(svg);
}

document.getElementById('resetView').addEventListener('click',()=>{
  view={...view,x:0,y:0,k:1,rot:0};renderPreview();
});

// SVG generator (simplified/optimized for clarity)
function buildMedallionSvg(v){
  const NS = 'http://www.w3.org/2000/svg', D=view.w, R=D/2;
  function colorPick(key,table,fallback){key=(key||'').toLowerCase();for(const[k,v]of table){if(k&&key.includes(k))return v;}return fallback;}
  const plateFill = colorPick(v.plate_color,[['black','#161b2a'],['navy','#0b2346'],['crimson','#801717'],['gray','#3a3b47'],['white','#f3f6f9']],"#161b2a");
  const rimColor = colorPick(v.rim_finish,[['gold','#eac64f'],['silver','#c8c7cf'],['steel','#b0b7c3'],['bronze','#c37f52'],['obsidian','#000']],"#6ee7ff");
  const textFill = colorPick(v.text_colors,[['white','#fff'],['gold','#eac64f'],['silver','#c8c7cf'],['cyan','#67e7ff'],['red','#e43b44'],['black','#111']], "#fff");
  const symColor = colorPick(v.symbol_color,[['red','#e43b44'],['silver','#c8c7cf'],['gold','#eac64f'],['white','#fff'],['blue','#3b6ee4'],['cyan','#67e7ff']], "#67e7ff");
  const outlineCol = colorPick(v.outline_color,[['white','#fff'],['gold','#eac64f'],['silver','#c8c7cf'],['red','#e43b44'],['blue','#3b6ee4']], "#fff");

  const svg=document.createElementNS(NS,'svg');svg.setAttribute('viewBox',`0 0 ${D} ${D}`);svg.setAttribute('width',D);svg.setAttribute('height',D);
  // Base
  const M = (n,a,p)=>{const e=document.createElementNS(NS,n);for(const[k,v]of Object.entries(a||{}))e.setAttribute(k,v);(p||svg).appendChild(e);return e;}
  M('circle',{cx:R,cy:R,r:R*0.95,fill:plateFill,stroke:rimColor,'stroke-width':D*0.045});
  M('circle',{cx:R,cy:R,r:R*0.82,fill:'none',stroke:'#fff3','stroke-width':D*0.01});

  // Text arc
  if((v.text_top||"").trim()){
    const arc=M('path',{id:'topArc',d:`M ${R-0.73*R} ${R-0.73*R} A ${0.73*R} ${0.73*R} 0 1 1 ${R+0.73*R} ${R-0.73*R}`},svg);
    const t=M('text',{"font-size":D*0.075,"font-weight":900,fill:textFill,'text-anchor':'middle','letter-spacing':'.8'});
    const tp=M('textPath',{href:'#topArc',startOffset:'50%'},t);tp.textContent=v.text_top.toUpperCase();
    svg.appendChild(t);
  }
  // Main motif
  if((v.state_shape||"").toLowerCase().includes("florida")){
    M('path',{d:`M ${R-80} ${R+20} C ${R-35} ${R-20},${R+12} ${R-12},${R+64} ${R+10} C${R+85} ${R+35},${R+95} ${R+56},${R+112} ${R+84}`,stroke:outlineCol,'stroke-width':D*0.02,fill:'none'});
  }else{
    M('circle',{cx:R,cy:R,r:R*0.3,fill:'none',stroke:outlineCol,'stroke-width':D*0.014});
  }
  // Symbol
  if((v.main_symbol||"").toLowerCase().includes("death")){
    M('circle',{cx:R,cy:R,r:R*0.18,fill:symColor,stroke:'#222','stroke-width':D*0.01});
    M('line',{x1:R-R*0.18,y1:R,x2:R+R*0.18,y2:R,stroke:'#111','stroke-width':D*0.017});
    M('circle',{cx:R+R*0.07,cy:R-R*0.05,r:R*0.05,fill:'#222',stroke:'#3b3f48','stroke-width':D*0.008});
  }
  // Sabers (glow/animated highlight optional for production)
  if((v.sabers_desc||"").toLowerCase().includes("cross")){
    M('line',{x1:R-60,y1:R-60,x2:R+60,y2:R+60,stroke:'#67e7ff','stroke-opacity':.19,'stroke-width':14});
    M('line',{x1:R+60,y1:R-60,x2:R-60,y2:R+60,stroke:'#67e7ff','stroke-opacity':.19,'stroke-width':14});
  }
  return svg;
}

// Presets (example)
const DEFAULT_PRESETS=[
  {id:'fl_army',name:'Florida + Army',note:'Aurebesh rim ‚Ä¢ Crossed sabers',thumb:'FL',form:{text_top:"SAINT CLOUD JEDI",rim_finish:"metallic silver",plate_color:"black",text_colors:"white with black outline",state_shape:"state of Florida",outline_color:"white",main_symbol:"Death Star",symbol_color:"red with etched lines",badge_elements:"concentric rings",secondary_symbol:"Army star emblem",aurebesh_style:"glowing Aurebesh along rim",sabers_desc:"two crossed sabers glow",style_keywords:"cinematic, heraldic, symmetrical",flip_arc:"auto"}},
  {id:'det_wings',name:'Detroit + Wings',note:'Sports fusion ‚Ä¢ 3 beams',thumb:'DET',form:{text_top:"DETROIT JEDI",rim_finish:"polished steel",plate_color:"black",text_colors:"white",state_shape:"medallion field",outline_color:"red/black",main_symbol:"Death Star",symbol_color:"red etched",badge_elements:"concentric rings",secondary_symbol:"",aurebesh_style:"glowing inscriptions",sabers_desc:"three angled beams glow",style_keywords:"sports fusion, symmetrical",flip_arc:"auto"}},
];
function getPresets(){
  try{const arr=JSON.parse(localStorage.getItem('medallion:presets2'));return Array.isArray(arr)&&arr.length?arr:DEFAULT_PRESETS;}catch{return DEFAULT_PRESETS;}
}
function setPresets(arr){
  localStorage.setItem('medallion:presets2',JSON.stringify(arr)); renderProfiles();
}
const profilesHost=document.getElementById('profiles');
function renderProfiles(){
  profilesHost.innerHTML='';
  const q=(document.getElementById('profileSearch').value||'').toLowerCase();
  getPresets().filter(p=>!q||p.name.toLowerCase().includes(q)||p.thumb.toLowerCase().includes(q)).forEach(p=>{
    const li=document.createElement('div');li.className='profile';li.setAttribute('role','listitem');
    li.innerHTML=`<div class="thumb">${p.thumb}</div>
      <div><div style="font-weight:700">${p.name}</div><div class="subtle">${p.note}</div><span class="tag">Preset</span></div>
      <div><button class="chip" data-act="apply" type="button" title="Apply"><span class="material-icons">play_arrow</span></button></div>`;
    li.querySelector('[data-act="apply"]').addEventListener('click',()=>{fillForm(p.form,true);toast('Preset applied');});
    li.addEventListener('click',e=>{if(e.target.closest('[data-act]'))return;fillForm(p.form,true);toast('Preset loaded');});
    profilesHost.appendChild(li);
  });
}
document.getElementById('profileSearch').addEventListener('input', renderProfiles);

// Randomizer
document.getElementById('randBtn').addEventListener('click',()=>{
  const base=structuredClone(DEFAULT_PRESETS[Math.floor(Math.random()*DEFAULT_PRESETS.length)].form);
  base.rim_finish=['metallic silver','brushed silver','polished steel','gold','bronze'][Math.floor(Math.random()*5)];
  base.plate_color=['black','navy','crimson','gray','white'][Math.floor(Math.random()*5)];
  fillForm(base,true); toast('Random!');
});

// Export/Import (simple, extensible)
document.getElementById('exportBtn').addEventListener('click',()=>{
  toast('Export action (stubbed)');
});
document.getElementById('importBtn').addEventListener('click',()=>{
  toast('Import action (stubbed)');
});

// Initial form and profiles
fillForm(JSON.parse(localStorage.getItem(LS_FORM)||"{}"),true);
renderProfiles();
</script>
</body>
</html>
